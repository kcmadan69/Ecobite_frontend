<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EcoBite â€¢ Profile</title>
  <link rel="stylesheet" href="../CSS/style.css"/>

  <script type="module">
    import { renderProfile, navActivate } from "../js/app.js";

    const WELCOME_URL = "./welcome.html";

    window.addEventListener("DOMContentLoaded", () => {
      // Inject shared sidebar
      fetch("shared-sidebar.html")
        .then(r => r.text())
        .then(html => {
          document.querySelector("[data-sidebar]").outerHTML = html;
          navActivate("profile");

          // logout
          document.addEventListener("click", (e) => {
            const btn = e.target.closest("[data-logout]");
            if (!btn) return;
            e.preventDefault();

            try {
              localStorage.removeItem("ecobite_user");
              localStorage.removeItem("ecobite_token");
              sessionStorage.clear();
            } catch {}

            location.replace(WELCOME_URL);
          });
        })
        .then(renderProfile);
    });
  </script>
</head>

<body class="dash-shell">
  <div class="dash-layout">
    <aside data-sidebar></aside>

    <main class="dash-main">
      <!-- PROFILE HEADER / COVER -->
      <section class="profile-hero-card">
        <div class="profile-hero-main">
          <div class="profile-avatar" id="pfInitial">S</div>
          <div>
            <h2 class="profile-name" id="pfName">Eco Member</h2>
            <div class="profile-email" id="pfEmail">you@campus.edu</div>
          </div>
          <span class="profile-badge">ğŸŒ± Eco Member</span>
        </div>

        <div class="profile-about-row">
          <div>
            <h3>About Me</h3>
            <p>
              Share a bit about yourself and your sustainability journey! ğŸŒ
            </p>
          </div>
          <button type="button" class="profile-edit-btn">
            âœ Edit
          </button>
        </div>
      </section>

      <!-- TOP STATS (4 CARDS) -->
      <section class="profile-kpi-row">
        <article class="profile-kpi-card">
          <div class="profile-kpi-icon">ğŸ“¦</div>
          <div class="profile-kpi-label">Posts Shared</div>
          <div class="profile-kpi-value" id="kPosts">0</div>
        </article>

        <article class="profile-kpi-card">
          <div class="profile-kpi-icon">ğŸ‘¥</div>
          <div class="profile-kpi-label">People Fed</div>
          <div class="profile-kpi-value" id="kFed">0</div>
        </article>

        <article class="profile-kpi-card">
          <div class="profile-kpi-icon">ğŸ¥—</div>
          <div class="profile-kpi-label">Food Saved</div>
          <div class="profile-kpi-value" id="kSaved">0.0kg</div>
        </article>

        <article class="profile-kpi-card">
          <div class="profile-kpi-icon">ğŸ”¥</div>
          <div class="profile-kpi-label">Current Streak</div>
          <div class="profile-kpi-value" id="kStreak">0 days</div>
        </article>
      </section>

      <!-- IMPACT CARD -->
      <section class="profile-impact-card">
        <h3 class="profile-impact-title">Your Environmental Impact</h3>

        <div class="profile-impact-row">
          <div class="profile-impact-metric">
            <div class="profile-impact-label">COâ‚‚ emissions prevented</div>
            <div class="profile-impact-value" id="impactCO2">0.0 kg</div>
          </div>
          <div class="profile-impact-metric">
            <div class="profile-impact-label">Meals provided</div>
            <div class="profile-impact-value" id="impactMeals">0</div>
          </div>
        </div>

        <p class="profile-impact-quote">
          <em>â€œEvery meal shared is a step towards a sustainable futureâ€</em> âœ¨
        </p>
      </section>

      <!-- LEVEL + RECENT ACTIVITY -->
      <section class="row" style="gap:16px; margin-top:18px">
        <div class="panel" style="flex:1">
          <h3>Your Level</h3>
          <div style="display:flex; align-items:center; gap:12px; margin:8px 0 16px">
            <div class="logo" style="width:52px;height:52px;border-radius:14px;background:#eaf8f0">ğŸŒ±</div>
            <div>
              <strong>Seedling</strong>
              <span class="badge" style="margin-left:8px">Level 1</span><br/>
              <small id="levelPts">0 total points</small>
            </div>
          </div>
          <div style="background:#f1f7f3; border:1px solid #e6efe8; border-radius:12px; height:10px; overflow:hidden">
            <div id="levelBar" style="height:100%; width:0%; background:linear-gradient(90deg, #1ca44a, #2fb36b)"></div>
          </div>
          <div style="display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; color:#6a7b6a; font-size:14px">
            <div>+10 Share food</div>
            <div>+20 Successful claim (your food gets taken)</div>
            <div>+5 Claim food</div>
          </div>
        </div>

        <div class="panel" style="flex:1">
          <h3>Recent Activity</h3>
          <div id="pfActivity" class="grid" style="margin-top:10px"></div>
        </div>
      </section>

      <!-- ACHIEVEMENTS -->
      <section class="panel" style="margin-top:18px">
        <h3>Achievements</h3>
        <div style="display:grid; grid-template-columns:repeat(5,1fr); gap:10px; margin-top:10px">
          <div class="empty">First Share</div>
          <div class="empty">Helpful Starter</div>
          <div class="empty">Eco Warrior</div>
          <div class="empty">Consistent</div>
          <div class="empty">Generous Soul</div>
          <div class="empty">Community Hero</div>
          <div class="empty">Mega Saver</div>
          <div class="empty">Dedicated</div>
          <div class="empty">Food Champion</div>
          <div class="empty">Legendary</div>
        </div>
      </section>
    </main>
  </div>
</body>
</html>
