<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EcoBite ‚Ä¢ Food Feed</title>
  <link rel="stylesheet" href="../CSS/style.css"/>

  <script type="module">
    import { renderFeed, navActivate } from "../js/app.js";

    const WELCOME_URL = "./welcome.html";

    window.addEventListener("DOMContentLoaded", () => {
      // Inject sidebar
      fetch("shared-sidebar.html")
        .then(r => r.text())
        .then(html => {
          document.querySelector("[data-sidebar]").outerHTML = html;
          navActivate("home");

          // Logout
          document.addEventListener("click", (e) => {
            const btn = e.target.closest("[data-logout]");
            if (!btn) return;
            e.preventDefault();
            try {
              localStorage.removeItem("ecobite_user");
              localStorage.removeItem("ecobite_token");
              sessionStorage.clear();
            } catch {}
            location.replace(WELCOME_URL);
          });
        })
        .then(renderFeed);
    });
  </script>
</head>

<body class="dash-shell">
  <div class="dash-layout">
    <aside data-sidebar></aside>

    <!-- main page -->
    <main class="dash-main">
      <!-- PAGE HEADER -->
      <header class="page-head">
        <div>
          <h1 class="page-title">
            <span class="page-title-icon">üåø</span>
            Food Feed
          </h1>
          <p class="page-sub">Discover and share free food with your campus community üåç</p>
        </div>
      </header>

      <!-- TOP STATS ROW -->
      <section class="stats-row">
        <div class="stat-card">
          <div class="stat-icon stat-icon-box">üì¶</div>
          <div class="stat-body">
            <div id="stAvailable" class="stat-value">0</div>
            <div class="stat-label">Available Now</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon stat-icon-share">üë•</div>
          <div class="stat-body">
            <div id="stShared" class="stat-value">0</div>
            <div class="stat-label">Successfully Shared</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon stat-icon-trend">üìà</div>
          <div class="stat-body">
            <div id="stTotal" class="stat-value">0</div>
            <div class="stat-label">Total Posts</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon stat-icon-leaf">üçÉ</div>
          <div class="stat-body">
            <div id="stWaste" class="stat-value">0kg</div>
            <div class="stat-label">Food Waste Prevented</div>
          </div>
        </div>
      </section>

      <!-- FILTER / TOOLBAR BAR -->
      <section class="filter-block">
        <!-- scope tabs -->
        <div class="scope-tabs">
          <button class="scope-tab is-active" data-scope="available">
            <span class="scope-tab-ico">‚ú®</span> Available
          </button>
          <button class="scope-tab" data-scope="claimed">
            <span class="scope-tab-ico">ü§ù</span> Claimed
          </button>
          <button class="scope-tab" data-scope="expired">
            <span class="scope-tab-ico">‚è∞</span> Expired
          </button>
        </div>

        <!-- search bar -->
        <div class="feed-search-wrap">
          <span class="search-ico">üîç</span>
          <input
            id="search"
            class="feed-search"
            placeholder="Search for food (e.g., pizza, salad, cookies...)"
          />
        </div>

        <!-- filter buttons row -->
        <div class="filter-row">
          <!-- TYPE DROPDOWN (menu is built by app.js) -->
          <div class="dropdownish" data-dd="type">
            <button class="dropdown-btn" id="typeBtn">
              <span class="dd-left">
                üçΩ <span id="typeLabel">All Types</span>
              </span>
              <span class="dd-caret">‚ñæ</span>
            </button>
          </div>

          <!-- SORT DROPDOWN (menu is built by app.js) -->
          <div class="dropdownish" data-dd="sort">
            <button class="dropdown-btn" id="sortBtn">
              <span class="dd-left">
                ‚è± <span id="sortLabel">Newest First</span>
              </span>
              <span class="dd-caret">‚ñæ</span>
            </button>
          </div>

          <!-- DIETARY DROPDOWN (chip menu is built by app.js) -->
          <div class="dropdownish" data-dd="diet">
            <button class="dropdown-btn" id="dietBtn">
              <span class="dd-left">
                ‚ò∞ <span id="dietLabel">Dietary</span>
              </span>
              <span class="dd-caret">‚ñæ</span>
            </button>
          </div>
        </div>
      </section>

      <!-- FEED LIST -->
      <section id="feed" class="feed-list"></section>

      <!-- EMPTY STATE -->
      <section id="emptyFeed" class="empty-state">
        <div class="empty-icon">üçÉ</div>
        <h2 class="empty-head">No posts yet</h2>
        <p class="empty-desc">Be the first to share food and reduce waste!</p>
      </section>
    </main>
  </div>
</body>
</html>
